#!/usr/bin/env ruby
#
# npm2rpm
#
#  Generate spec from Nodejs NPM
#
# Copyright (c) 2013 Klaus KÃ¤mpf <kkaempf@suse.de>
#
# Licensed under the Ruby license
#

require 'rubygems'

$:.push(File.join(File.dirname(__FILE__), '..', 'lib'))

require 'npm2rpm'

options = Npm2Rpm::Options.new

metadata = Npm2Rpm::Metadata.new options.package, options.version

spec = Npm2Rpm::Spec.new(metadata)

begin
  Dir.mkdir spec.name
rescue Errno::EEXIST
end
Dir.chdir spec.name

spec.write
changes = Npm2Rpm::Changes.new(spec.name, metadata, options)
changes.write
Npm2Rpm::Rpmlintrc.new(spec.name, metadata, options).write

Dir.chdir ".."

Kernel.system "osc add #{spec.name}"

Dir.chdir spec.name
Kernel.system "osc ci -m '#{changes.message}'"
Dir.chdir ".."
